Тестовое задание

Выполнил Сергей Дмитриевич Гордейчук (Sergey Gordeychuk) sega074@yandex.ru

При выполнении тестового задания использовался мультиадресный режим работы карт



Задание №1 Описание Алгоритма работы:

Задание:
Система состоит из контроллера и панелей, в системе только 1 контроллер. Все устройства объеденены сетью. Информация введеная с консоли контроллера  должна отображаться на парелях.
Панели переиодически отправляют информацию для контроллера ( тепрература и освещенность). Контроллер принимает информацию со всех панеле вычисляет
среденнее значение и отправляет информацию для отображения на все панели. Панели должны подключаться к сети автоматически (панели не конфигурируются для подключения)
При пропадании из сети контроллера его место должна занять одна из панелей, при возвращении контроллера его метсто должно быть освобождено дублирующей его функционал
панелью.


Описание алгоритма работы системы по установленному заданию:

используем понятия:
    - контроллкр 
    - панель 
    - узел - это или контроллер или панель
    - группа - это понятие из мульти адресации
    - идентификатор - число присваеиваемое узлу

1. Принят следующий порядок работы:
    - сообщения от любого узла отаправляются на на мульти адрес и слышется всей группой( для каждого узла задается одинаковый мультиадрес/группа и порт);
    - все узлы должны иметь свой идентификатор, 0 - зарезервирован для контроллера, для панелей от 1 до какогото разумного числа( разумнеое число определяется масштабами сети);
    - панели получают свой адрес динамически ( при включении и/или подключении), получают его на все время работы, каждая панель отискивает минимально возможный адрес;
    - контроллер получает свой адрес 0 при старте;


2. В алгоритме установлены 2 периода 
    - период отправки запросов;
    - перод молчания после кторого считается что контроллер или ведущаяя панель отвалилась.

3.  Если запустился (мульти адрес, группа, порт) контроллер, то он периодически в сеть отправляет запросы на получение данных с панелей, получая данные с панелей,
вычисляет среденне значение температуры и освещенности, и  отправляет эти данные в следующем запросе, кроме этого добавляет в запрпос текст сообщения.
Текст сообщения вводится с консоли контроллера.

4. Панель после включения не имеет иденнтификатора ( обозначим это через -1), но она имеет доступ к мультиадресной группе и прослушивает данную группу.

4.1. Если в группе есть "живые" узлы то в течении 3 перодов запроса панель строит себе карту каие узлы есть на связи и какие у них id(иды), после получения данной информации,
выбирает себе наименьший id(ид) и под эти id(идом) пытается отвечать на запросы.

4.2. Если после выбора id(ида), или в процессе работы панель получает информацию что кто то еще работает с таким жк id(идом), то каждая из панелей с дубликатом id(ида) выполняет
отказ по случайному закону одно из действий - отказ от данного id(ида) или продолжение использовани данного id(ида).  Если панель отказывается от id(ида) то повторяет действия как
будто ее заново включили(п. 4.1).

4.3. Если панель включилась и ни кого неслышит то она выбирает 1 идентификатор далее п. 4.2.


5. Прослушивая группу мульти-адресов панель ведет для себя карту в которую добавляет и обновляет информацию по активным узлам, по необходимости удаляет узлы после истечения периода молчания узла.

5.1 Если прошол период молчания, и в течении него небыло запросов от контроллера или панели которая выступает в качестве контроллера то панель на основании свой карты определяет, является ли она
кандидатом на панель-контролер или нет. Панель-контроллер кандидат отправляет запрос аналогичный запросу контроллера, адругие панели будут на него отвечать обычным образом. Если же панел принела запрос
от панели-контроллер и по идентификатору видит что она находится в приоритете, лучшим кандитатом - ее id(ид) меньше, то эта панель повторяет запрос но со своим идетификатором.
Другие панели принявшие запрос отвечают на него как обычно. Точно также поступает сам контроллер.

5.2. Отправка запросов от панелей кандитатов начинается после перода молчания, на каждый период отправки запроса.



Предсталенная программа имеет следующие ключи:

                --srv или -s запуск в режиме контроллера 
                --madr или -a адрес группы многоадресной рассылки          ip фдрес для групповых рассылок от 224.0.0.3- 224.0.0.255
                --port или -p порт приема групповых рассылок                                 
                --szuni или -u допустимое количестов узлов в сети  
                --clkreq или -с период опроса данных с табло в секундах  
                --lose bkb -l допустимое время потери для контроллера в секундах
                --help вывод данной подсказки и звершение выполения программы         

                
Для тестирования программы необходимо запустить данную программу на нескольких хостах сети которые будут использоваться в качестве моделей контроллера или панелей
                
После запуска на консоль будет выводится периодически информация  панели или  контролера, взависимости от режива запуска.
для ввода информации надо нажать просто Enter в это случае программа перейде врежим приема команды ( будет выведена подсказка) после ввода информации опять нужно
нажать Enter и программа перейде в прежний режим.


Для написания использовался KDevelop, СMake (эти инструменты и gcc необходимы для сборки программы)


по всем вопросам: sega074@yandex.ru ( 906-866-4477) Сергей ДмитриевичГордейчук ( Sergey Gordeychuk)

